
<script src='/javascripts/file-folder-utilities-0.1.js'> </script>
<script type="text/javascript" src="/javascripts/3rd-party/plugins/jquery-simple-tree-menu-1.2.5.js"></script>
<script type="text/javascript" src="/javascripts/3rd-party/plugins/jquery-cookie-0.6.5.js"></script>
<link rel="stylesheet" href="/cascading_stylesheets/3rd-party/jq-simple-tree-menu-1.2.5.css"/>
<style>
.hovering {
	border-style: dotted;
	border: 2px;
	border-color: #FE57A1;
	background: #aaa;
}
</style>

<form name="contain_me" id="contain_me" method="post">
<span class="drop_on_me" ><i>All&nbsp;pages&nbsp;and&nbsp;folders</i>&nbsp;<img alt='pop up menu' id='the-image' onmouseover='this.style.cursor="hand"; this.src="/images/down-arrow-hover.png"' onmouseout='this.style.cursor="auto"; this.src="/images/down-arrow.png"' style='float:right; display:inline; margin-top: 8px' src='/images/down-arrow.png'></span><hr>
<script>$('#the-image').toggle(superMenuIn, superMenuOut); var label_array = [];</script>

<ul class="tree">

<?cs def:display_files(epages) ?>
  <?cs each:epage = epages ?>
    <?cs if:epage.kind == -1 ?>
      <li>
      	<span id='the-folder-<?cs var:epage.id ?>' class='drag_me drop_on_me igor'><i><?cs var:epage.label?></i>&nbsp;<img alt='pop up menu' id='the-image-<?cs var:epage.id ?>' onmouseover='this.style.cursor="hand"; this.src="/images/down-arrow-hover.png"' onmouseout='this.style.cursor="auto"; this.src="/images/down-arrow.png"' style='float:right; display:none; margin-top: 8px' src='/images/down-arrow.png'></span>
      	<script>
      		$('#the-image-<?cs var:epage.id ?>').toggle(superMenuIn, superMenuOut);
      		label_array['<?cs var:epage.id ?>'] = '<?cs var:epage.label?>';
      	</script>
      	<ul>
      	<?cs call:display_files(epage.folder) ?>
      	</ul>
      </li>
    <?cs else ?>
      <li>
      	<span id='the-epage-<?cs var:epage.id ?>' class='drag_me'><?cs var:epage.symbol ?><a style='display:inline;' href='epage/<?cs var:epage.id ?>'> <?cs var:epage.label ?></a></span>
      	<script>
      		
      	</script>
      </li>
    <?cs /if ?>
  <?cs /each ?>
<?cs /def ?>

<?cs call:display_files(Epages) ?>

</ul>
</form>

<!-- <?cs var:epage.controller ?>?id=<?cs var:epage.id ?>&name=<?cs var:epage.s_label ?> -->

<script type="text/javascript">
  $(document).ready(function() {
  	$(".tree").simpleTreeMenu();
  	$(".tree").simpleTreeMenu('deserialize', 'cookie'); /* session cookie or other? */
    $(".igor").hover(
      function () {
        /*
        var img_kid = $(this)[0].children[0].children[0];
        img_kid.setAttribute("style", "float:right; display:inline; margin-top: 8px")
        */
        $($(this)[0].children[1]).show();
      },
      function () {
        /*
        var img_kid = $(this)[0].children[0].children[0];
        img_kid.setAttribute("style", "float:right; display:none; margin-top: 8px")
        */
        $($(this)[0].children[1]).hide();
      }
    );
    function handle_drop( event, ui ) {
    	var target_id = event.target.id;
  		var target_val = target_id.split('-')[2]
  		console.log(target_val);
    	var source_id = ui.draggable.attr('id')
  		var source_val = source_id.split('-')[2]
  		console.log(source_val);
  		if (target_val === undefined) {
  			target_val = 0;
  		}
  		document.contain_me.action = '/epage/move/'+source_val+'/'+target_val;
  		document.contain_me.submit();
	}
    $('.drop_on_me').droppable( {
    	hoverClass: 'hovering',
    	drop: handle_drop
  	});
    function handle_drag( event, ui ) {
  		var offsetXPos = parseInt( ui.offset.left );
  		var offsetYPos = parseInt( ui.offset.top );
  		$('#xy').text("" + offsetXPos + ", " + offsetYPos);
	}
    function handle_stop( event, ui ) {
    	//alert('stopped');
	}
    function oh_baby( event ) {
  		return '<div id="draggableHelper">I am a helper - drag me!</div>';
	}
	
    $('.drag_me').draggable( {
    	containment: '#contain_me',
    	helper: oh_baby,
    	drag: handle_drag,
    	stop: handle_stop,
    	mouse: 'move'
    });
  });
  $(window).unload(function() {
  	$(".tree").simpleTreeMenu('serialize', 'cookie');
  });
</script>
